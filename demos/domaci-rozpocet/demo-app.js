// Demo: žádné ukládání. Všechno jen v paměti. Kategorie jsou napevno.\n(() => {\n  const CATS = [\n    { id:'home',    name:'Domácnost',    color:'#4f77ff' },\n    { id:'transport', name:'Doprava',   color:'#ff7a59' },\n    { id:'food',    name:'Jídlo',        color:'#ffcc3d' },\n    { id:'housing', name:'Nájem / hypotéka', color:'#43d394' },\n    { id:'clothes', name:'Nákupy/oblečení', color:'#a58bff' },\n    { id:'subs',    name:'Předplatné',   color:'#52d1ff' },\n    { id:'dine',    name:'Stravování venku', color:'#ff8cd1' },\n    { id:'fun',     name:'Zábava',       color:'#8edb6b' }\n  ];\n\n  // In-memory stav\n  const state = {\n    month: '2025-10',\n    tx: [\n      {date:'2025-10-06', note:'Výplata', type:'income', category:'', amount: 34137},\n      {date:'2025-10-07', note:'Nájem', type:'expense', category:'housing', amount:11500},\n      {date:'2025-10-09', note:'Potraviny', type:'expense', category:'food', amount: 980},\n      {date:'2025-10-12', note:'MHD kupon', type:'expense', category:'transport', amount: 365},\n      {date:'2025-10-15', note:'Spotify', type:'expense', category:'subs', amount: 169},\n      {date:'2025-10-16', note:'Restaurace', type:'expense', category:'dine', amount: 420},\n    ],\n  };\n\n  // DOM refs\n  const el = (id) => document.getElementById(id);\n  const monthSelect = el('monthSelect');\n  const addBtn = el('addBtn');\n  const rows = el('rows');\n  const incomes = el('incomes');\n  const expenses = el('expenses');\n  const balance = el('balance');\n  const legend = el('legend');\n  const chart = el('chart');\n\n  // init select kategorií\n  const catSelect = el('txCategory');\n  CATS.forEach(c => {\n    const o = document.createElement('option');\n    o.value = c.id; o.textContent = c.name;\n    catSelect.appendChild(o);\n  });\n\n  // Přidání transakce\n  addBtn.addEventListener('click', () => {\n    const d = el('txDialog');\n    // defaulty\n    el('txDate').value = state.month + '-15';\n    el('txNote').value = '';\n    el('txType').value = 'expense';\n    el('txCategory').value = CATS[0].id;\n    el('txAmount').value = '';\n    d.showModal();\n  });\n\n  el('txForm').addEventListener('submit', (e) => {\n    e.preventDefault();\n    const t = {\n      date: el('txDate').value,\n      note: el('txNote').value.trim(),\n      type: el('txType').value,\n      category: el('txType').value === 'income' ? '' : el('txCategory').value,\n      amount: Math.max(0, Number(el('txAmount').value || 0))\n    };\n    // měsíční filtr – jen transakce v aktuálním měsíci\n    if (!t.date.startsWith(state.month)) {\n      alert('V demu jde přidávat jen do vybraného měsíce.');\n      return;\n    }\n    state.tx.push(t);\n    el('txDialog').close();\n    render();\n  });\n\n  monthSelect.addEventListener('change', () => {\n    state.month = monthSelect.value;\n    render();\n  });\n\n  function fmt(n){\n    return n.toLocaleString('cs-CZ') + ' Kč';\n  }\n\n  function render(){\n    // filtr měsíce\n    const tx = state.tx.filter(t => t.date.startsWith(state.month));\n    // součty\n    const inc = tx.filter(t=>t.type==='income').reduce((a,b)=>a+b.amount,0);\n    const exp = tx.filter(t=>t.type==='expense').reduce((a,b)=>a+b.amount,0);\n    incomes.textContent = fmt(inc);\n    expenses.textContent = fmt(exp);\n    balance.textContent = fmt(inc-exp);\n\n    // tabulka\n    rows.innerHTML = tx.map(t => {\n      const cat = t.type==='expense' ? (CATS.find(c=>c.id===t.category)?.name || '—') : '—';\n      const typ = t.type==='income' ? 'Příjem' : 'Výdaj';\n      const amount = (t.type==='income' ? '+' : '−') + t.amount.toLocaleString('cs-CZ') + ' Kč';\n      return `<tr>\n        <td>${t.date}</td><td>${escapeHTML(t.note||'')}</td>\n        <td>${cat}</td><td>${typ}</td><td class=\"r\">${amount}</td></tr>`;\n    }).join('');\n\n    // rozpad výdajů podle kategorií\n    const byCat = new Map();\n    for (const t of tx) if (t.type==='expense') {\n      byCat.set(t.category, (byCat.get(t.category)||0) + t.amount);\n    }\n    const parts = CATS.map(c => ({...c, value: byCat.get(c.id)||0})).filter(p => p.value>0);\n    drawDonut(parts);\n    drawLegend(parts, exp);\n  }\n\n  function drawLegend(parts, total){\n    if (!parts.length){ legend.innerHTML = '<p class=\"muted\">Žádné výdaje v měsíci.</p>'; return; }\n    legend.innerHTML = '<ul>' + parts.map(p => {\n      const share = total ? Math.round(p.value/total*100) : 0;\n      return `<li><span><span class=\"dot\" style=\"background:${p.color}\"></span>${p.name}</span><strong>${share}%</strong></li>`;\n    }).join('') + '</ul>';\n  }\n\n  function drawDonut(parts){\n    chart.innerHTML = '';\n    const size = 240; const r = 90; const c = size/2;\n    const total = parts.reduce((a,b)=>a+b.value,0) || 1;\n    let prev = 0;\n    const svg = elSVG('svg'); svg.setAttribute('viewBox',`0 0 ${size} ${size}`); svg.classList.add('donut');\n    // šedé pozadí\n    svg.appendChild(circle(c,c,r,'#1f2634', 18));\n    for (const p of parts){\n      const frac = p.value/total;\n      const dash = 2*Math.PI*r*frac;\n      const gap  = 2*Math.PI*r*(1-frac);\n      const arc = circle(c,c,r,p.color, 18);\n      arc.setAttribute('stroke-dasharray', `${dash} ${gap}`);\n      arc.setAttribute('transform', `rotate(${prev*360-90} ${c} ${c})`);\n      svg.appendChild(arc);\n      prev += frac;\n    }\n    // střed\n    svg.appendChild(circle(c,c,60, 'var(--panel)', 60));\n    chart.appendChild(svg);\n  }\n\n  function circle(cx,cy,r, stroke, w){\n    const e = elSVG('circle');\n    e.setAttribute('cx',cx); e.setAttribute('cy',cy); e.setAttribute('r',r);\n    e.setAttribute('fill','transparent'); e.setAttribute('stroke', stroke);\n    e.setAttribute('stroke-width', w);\n    e.setAttribute('stroke-linecap','butt');\n    return e;\n  }\n  function elSVG(tag){ return document.createElementNS('http://www.w3.org/2000/svg', tag); }\n  function escapeHTML(s){ return s.replace(/[&<>\"']/g, m => ({'&':'&','<':'<','>':'>','\"':'"',\"'\":'&#39;'}[m])); }\n\n  // start\n  monthSelect.value = state.month;\n  render();\n})();\n
